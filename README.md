# StepperMRTO
StepperMRTO provides a means to control a linear stepper motor to actuate a model railroad turnout (track switch). In particular the stepper to be controlled will be a "micro" variety that is so small that it can be installed on top of the layout next to the track. Traditionally such actuators have never been stepper motors and are usually installed on the underside of the layout. This code is meant to used along with a "sketch" (program) in an Arduino Nano microcontroller.  
When configured properly the stepper can be connected to the turnout throwbar directly with no omega or Z motion absorbers required. The stepper motor will skip harmlessly if the mechanism encounters an obstruction. It will then recalibrate its position on the next commanded movement. The system also requires no position calibration at installation other than to make sure that the throw is long enough to enable reaching both stock rails and that the torque is strong enough for reliable operation. The code in StepperMRTO.cpp sets up initial conditions that should provide for good performance out of the box.  
Several aspects of the stepper operation can be controlled, namely the speed, length of throw, force (torque) and direction (reversed or not). These are initially set within the Stepper.ino program. Initial values are speed = 1000, throw = 500, force = 1500, reversed = false. As a reference a throw value of 1000 moves the stepper carriage about 7mm.
The program also includes a menu driven mechanism to change these initial values. This allows the changes to be made without removing the Arduino from its socket and without requiring the use of the Arduino IDE. A portable device such as a laptop, tablet or phone will be plugged into the USB connector to use the menu. The Arduino should be powered externally, not from the USB connector, to use the menu system efficiently. The menu is activated by closing the switch for device 1 while pushing the reset button on the Arduino. The baud rate is 115,200.
The code provides for driving four steppers. If commanded simultaneously the program will automatically sequence their movement so that only one runs at a time. Outputs are provided to drive four sets of LEDs, one red and one green for each stepper. These indicate the commanded position. The LEDs will flash while the stepper is moving.
The steppers are controllable by local momentary switches which toggle the direction of motion. They could also be controlled remotely using a device such as the LCC based rrCirkits Tower node. Any remotely controlled device that can pulse the switch inputs low will work as well.  
The program does not accomodate position feedback. It only knows that it has commanded the turnout in one direction or the other and it assumes that it reaches the other side. The LED indication will be correct for the commanded position. On startup the program does not know the position of the turnout. It will flash the LEDs to indicate this condition. On first command it will move the turnout in a certain, configurable direction. It may already physically be in the commanded position and in that case it will run into the closure rail and the motor will 'slip' until movement is complete. At that point it will be in a known position and will set the LED to the correct non-flashing color.
StepperMRTO.cpp and StepperMRTO.h should be placed in the libraries folder in the Arduino file structure. Stepper.ino should be placed in a folder of the same name placed at the top level of the Arduino file structure. It can then be accessed from the Arduino IDE.
